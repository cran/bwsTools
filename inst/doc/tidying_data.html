<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Tidying Data for Analysis</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Tidying Data for Analysis</h1>



<p>The <code>bwsTools</code> package requires data to be in a specified formatâ€”but your data might not look like this when you first get it. For more on this format, see <a href="https://osf.io/xftvq/">the paper introducing this package</a> as well as the documentation for what specific functions require.</p>
<p>This vignette looks at two ways best-worst scaling data may be formatted initially and shows how to use the <code>tidyverse</code> packages <code>dplyr</code> and <code>tidyr</code> to get your data into the format that is required for the <code>bwsTools</code> functions.</p>
<p>First, we load the packages we need:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bwsTools)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)</code></pre></div>
<p>For simplicity's sake, imagine a simple scenario where three survey respondents respond to a best-worst scaling design that has four items that appear over four trials of three options. The data appear in &quot;wide&quot; format, where each row is a participant (<code>pid</code> being the unique identifier). The column names follow a standardized format: <code>qX_Z</code>, where <code>X</code> denotes what trial it was (one through four) and <code>Z</code> indicates the item shown (the first, second, or third item). Values are <code>2</code> if it was chosen as best, <code>1</code> if it was chosen as worst, and <code>NA</code> if it was not chosen. I find that this is how data come down from most common platforms, such as Qualtrics. Example data may look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1
<span class="co">#&gt; # A tibble: 3 x 13</span>
<span class="co">#&gt;     pid  q1_1  q1_2  q1_3  q2_1  q2_2  q2_3  q3_1  q3_2  q3_3  q4_1  q4_2  q4_3</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     2    NA     1     1     2    NA    NA     2     1    NA     2     1</span>
<span class="co">#&gt; 2     2     2    NA     1     1    NA     2     1     2    NA     2     1    NA</span>
<span class="co">#&gt; 3     3     2     1    NA    NA     1     2     2     1    NA     2     1    NA</span></code></pre></div>
<p>We can see that, in the first trial, respondents 1 and 2 both chose the third option as worst and first option as best In the fourth trial, respondents 2 and 3 both chose the second option as worst and the first option as best. But what do these refer to?</p>
<p>I like to have a <code>data.frame</code> that I call <code>key</code>. This tells me what each option in each trial refers to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">key
<span class="co">#&gt; # A tibble: 12 x 2</span>
<span class="co">#&gt;    q     label        </span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;        </span>
<span class="co">#&gt;  1 q1_1  Steak N Shake</span>
<span class="co">#&gt;  2 q1_2  Shake Shack  </span>
<span class="co">#&gt;  3 q1_3  Whataburger  </span>
<span class="co">#&gt;  4 q2_1  Culvers      </span>
<span class="co">#&gt;  5 q2_2  Shake Shack  </span>
<span class="co">#&gt;  6 q2_3  Whataburger  </span>
<span class="co">#&gt;  7 q3_1  Steak N Shake</span>
<span class="co">#&gt;  8 q3_2  Culvers      </span>
<span class="co">#&gt;  9 q3_3  Shake Shack  </span>
<span class="co">#&gt; 10 q4_1  Steak N Shake</span>
<span class="co">#&gt; 11 q4_2  Culvers      </span>
<span class="co">#&gt; 12 q4_3  Whataburger</span></code></pre></div>
<p>This allows us to interpret the above data better: respondents 1 and 2 both chose Whataburger as worst and Steak N Shake as best in the first trial.</p>
<p>I assume some knowledge of using the tidyverse, but I suggest checking out <a href="https://r4ds.had.co.nz/"><em>R for Data Science</em></a> for a gentle introduction to it if you are not.</p>
<p>The following pipe chain shows how to take the <code>data.frame</code> above and format it how the package would like for calculating individual-level scores. See comments for additional explanation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1_i &lt;-<span class="st"> </span>dat1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 1. collect all of the non-pid columns, where variable names are filled into</span>
<span class="st">  </span><span class="co">#    the column q, and the values are in column resp</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;q&quot;</span>, <span class="st">&quot;resp&quot;</span>, <span class="op">-</span>pid) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">resp =</span> <span class="kw">case_when</span>(  <span class="co"># 2. recode resp such that</span>
      resp <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,   <span class="co">#    if resp is 2, make it 1</span>
      resp <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>,  <span class="co">#    if resp is 1, make it -1</span>
      <span class="kw">is.na</span>(resp) <span class="op">~</span><span class="st"> </span><span class="dv">0</span>  <span class="co">#    if resp is NA, make it zero</span>
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 3. join with the key data.frame by the column q</span>
<span class="st">  </span><span class="kw">left_join</span>(key, <span class="dt">by =</span> <span class="st">&quot;q&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 4. separate the q column into the block number and the item number</span>
<span class="st">  </span><span class="co">#    by the underscore</span>
<span class="st">  </span><span class="kw">separate</span>(q, <span class="kw">c</span>(<span class="st">&quot;block&quot;</span>, <span class="st">&quot;temp&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 5. unselect the item number, since it is no longer needed</span>
<span class="st">  </span><span class="co">#    as you have the item name now</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>temp)</code></pre></div>
<p>This now follows the tidy format that <code>bwsTools</code> requires. One column indicates the unique identifier for the respondent, another the trial (or block) that the choices were presented in, the response (as 1 if best, -1 if worst, and 0 as unselected), and the name of the item.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1_i
<span class="co">#&gt; # A tibble: 36 x 4</span>
<span class="co">#&gt;      pid block  resp label        </span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;        </span>
<span class="co">#&gt;  1     1 q1        1 Steak N Shake</span>
<span class="co">#&gt;  2     2 q1        1 Steak N Shake</span>
<span class="co">#&gt;  3     3 q1        1 Steak N Shake</span>
<span class="co">#&gt;  4     1 q1        0 Shake Shack  </span>
<span class="co">#&gt;  5     2 q1        0 Shake Shack  </span>
<span class="co">#&gt;  6     3 q1       -1 Shake Shack  </span>
<span class="co">#&gt;  7     1 q1       -1 Whataburger  </span>
<span class="co">#&gt;  8     2 q1       -1 Whataburger  </span>
<span class="co">#&gt;  9     3 q1        0 Whataburger  </span>
<span class="co">#&gt; 10     1 q2       -1 Culvers      </span>
<span class="co">#&gt; # â€¦ with 26 more rows</span></code></pre></div>
<p>And the following code demonstrates how to do so if one wanted to calculate aggregate scores. Note that it starts with the individual-level data, <code>dat1_i</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1_a &lt;-<span class="st"> </span>dat1_i <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 1. group by the label</span>
<span class="st">  </span><span class="kw">group_by</span>(label) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 2. summarise such that...</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">total =</span> <span class="kw">n</span>(),              <span class="co"># n() shows number of times the item appeared</span>
    <span class="dt">best =</span> <span class="kw">sum</span>(resp <span class="op">==</span><span class="st"> </span><span class="dv">1</span>),    <span class="co"># sum up the number of times it was selected best</span>
    <span class="dt">worst =</span> <span class="kw">sum</span>(resp <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>),  <span class="co"># and sum up the times it was selected as worst</span>
  )
<span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></code></pre></div>
<p>And you can see below that these now run without any errors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res1_i &lt;-<span class="st"> </span><span class="kw">e_bayescoring</span>(dat1_i, <span class="st">&quot;pid&quot;</span>, <span class="st">&quot;block&quot;</span>, <span class="st">&quot;label&quot;</span>, <span class="st">&quot;resp&quot;</span>)
<span class="kw">head</span>(res1_i)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;     pid label         b_ebayes</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1 Culvers         0.582 </span>
<span class="co">#&gt; 2     1 Shake Shack    -0.0404</span>
<span class="co">#&gt; 3     1 Steak N Shake   0.739 </span>
<span class="co">#&gt; 4     1 Whataburger    -1.44  </span>
<span class="co">#&gt; 5     2 Culvers        -0.671 </span>
<span class="co">#&gt; 6     2 Shake Shack    -0.0404</span></code></pre></div>
<p>By default, it gets returned in the tidy format. This makes it perfect for plotting. But let's say you wanted to join it back to your original data, because you want to correlate scores with, for example, age. You could specify the format to return as <code>wide</code> and then join back to the original data, <code>dat1</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">e_bayescoring</span>(dat1_i, <span class="st">&quot;pid&quot;</span>, <span class="st">&quot;block&quot;</span>, <span class="st">&quot;label&quot;</span>, <span class="st">&quot;resp&quot;</span>, <span class="dt">wide =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(dat1, <span class="dt">by =</span> <span class="st">&quot;pid&quot;</span>)
<span class="kw">head</span>(dat1)
<span class="co">#&gt; # A tibble: 3 x 17</span>
<span class="co">#&gt;     pid Culvers `Shake Shack` `Steak N Shake` Whataburger  q1_1  q1_2  q1_3</span>
<span class="co">#&gt;   &lt;int&gt;   &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1   0.582       -0.0404           0.739     -1.44       2    NA     1</span>
<span class="co">#&gt; 2     2  -0.671       -0.0404           0.739     -0.0202     2    NA     1</span>
<span class="co">#&gt; 3     3  -1.47        -1.47             3.50       0.604      2     1    NA</span>
<span class="co">#&gt; # â€¦ with 9 more variables: q2_1 &lt;dbl&gt;, q2_2 &lt;dbl&gt;, q2_3 &lt;dbl&gt;, q3_1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   q3_2 &lt;dbl&gt;, q3_3 &lt;dbl&gt;, q4_1 &lt;dbl&gt;, q4_2 &lt;dbl&gt;, q4_3 &lt;dbl&gt;</span></code></pre></div>
<p>That <code>key</code> above assumes that everyone is seeing the same design. What if they aren't? Data in this situation might look like it does below. There are now two columns for each decision: one indicating if it was selected best, worst, or unselected (<code>qX_iZ_y</code> below), and one indicating what the item read (<code>qX_iZ_t</code>) where <code>X</code> again represents what trial (i.e., block) the respondent was on and the <code>Z</code> represents the item number. Then <code>_y</code> indicates it is the response and <code>_t</code> indicates it is the label. These data may look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2
<span class="co">#&gt; # A tibble: 3 x 25</span>
<span class="co">#&gt;     pid q1_i1_y q1_i1_t q1_i2_y q1_i2_t q1_i3_y q1_i3_t q2_i1_y q2_i1_t q2_i2_y</span>
<span class="co">#&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1       2 Steak â€¦      NA Shake â€¦       1 Whatabâ€¦       1 Culvers       2</span>
<span class="co">#&gt; 2     2       2 Steak â€¦      NA Shake â€¦       1 Whatabâ€¦       1 Culvers      NA</span>
<span class="co">#&gt; 3     3       2 Steak â€¦       1 Shake â€¦      NA Whatabâ€¦      NA Culvers       1</span>
<span class="co">#&gt; # â€¦ with 15 more variables: q2_i2_t &lt;chr&gt;, q2_i3_y &lt;dbl&gt;, q2_i3_t &lt;chr&gt;,</span>
<span class="co">#&gt; #   q3_i1_y &lt;dbl&gt;, q3_i1_t &lt;chr&gt;, q3_i2_y &lt;dbl&gt;, q3_i2_t &lt;chr&gt;, q3_i3_y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   q3_i3_t &lt;chr&gt;, q4_i1_y &lt;dbl&gt;, q4_i1_t &lt;chr&gt;, q4_i2_y &lt;dbl&gt;, q4_i2_t &lt;chr&gt;,</span>
<span class="co">#&gt; #   q4_i3_y &lt;dbl&gt;, q4_i3_t &lt;chr&gt;</span></code></pre></div>
<p>The tidying procedure is similar to that above. See comments below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2_i &lt;-<span class="st"> </span>dat2 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 1. collect all of the non-pid columns, where the column name is now called</span>
<span class="st">  </span><span class="co">#    temp, and the values in those columns are now all in the value column</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;temp&quot;</span>, <span class="st">&quot;value&quot;</span>, <span class="op">-</span>pid) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 2. break apart the temp column by the underscore, so now it indicates</span>
<span class="st">  </span><span class="co">#    the block in the block column, the item number in the item column,</span>
<span class="st">  </span><span class="co">#    and whether or not the value refers to the label (t) or response (y)</span>
<span class="st">  </span><span class="co">#    in column t_or_y</span>
<span class="st">  </span><span class="kw">separate</span>(temp, <span class="kw">c</span>(<span class="st">&quot;block&quot;</span>, <span class="st">&quot;item&quot;</span>, <span class="st">&quot;t_or_y&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 3. spread out t_or_y, filling it with the values of value</span>
<span class="st">  </span><span class="kw">spread</span>(t_or_y, value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 4. recode answers, just like in the above example</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">y =</span> <span class="kw">case_when</span>(
      y <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      y <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>,
      <span class="kw">is.na</span>(y) <span class="op">~</span><span class="st"> </span><span class="dv">0</span>
    )
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># 5. remove the item number column, as it is not needed anymore</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>item)</code></pre></div>
<p>Now, the data are in the correct format for using the <code>bwsTools</code> individual scoring functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2_i
<span class="co">#&gt; # A tibble: 36 x 4</span>
<span class="co">#&gt;      pid block t                 y</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1 q1    Steak N Shake     1</span>
<span class="co">#&gt;  2     1 q1    Shake Shack       0</span>
<span class="co">#&gt;  3     1 q1    Whataburger      -1</span>
<span class="co">#&gt;  4     1 q2    Culvers          -1</span>
<span class="co">#&gt;  5     1 q2    Shake Shack       1</span>
<span class="co">#&gt;  6     1 q2    Whataburger       0</span>
<span class="co">#&gt;  7     1 q3    Steak N Shake     0</span>
<span class="co">#&gt;  8     1 q3    Culvers           1</span>
<span class="co">#&gt;  9     1 q3    Shake Shack      -1</span>
<span class="co">#&gt; 10     1 q4    Steak N Shake     0</span>
<span class="co">#&gt; # â€¦ with 26 more rows</span></code></pre></div>
<p>Using these individual-level data to aggregate up follows the same procedure as above.</p>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
